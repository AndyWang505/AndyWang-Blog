---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import Aside from '../../../layouts/Aside.astro';
import MobileNav from '../../../components/MobileNav.astro';

interface CategoryCount {
  [category: string]: {
    category: string;
    count: number;
  };
}

const blog = await getCollection('blog');
// get categories data
const categoriesCount = blog.reduce((acc: CategoryCount, post) => {
  if (acc[post.data.category]) {
    acc[post.data.category].count++;
  } else {
    acc[post.data.category] = {
      category: post.data.category,
      count: 1,
    };
  }
  return acc;
}, {});

const categoriesArray = Object.values(categoriesCount);
---

<Layout>
  <!-- Main content wrapper with same layout as other pages -->
  <div class="relative max-w-[var(--page-width)] mx-auto">
    <div class="transition duration-700 w-full grid grid-cols-[17.5rem_auto] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto] mx-auto gap-4">
      <Aside />
      <!-- mobile nav -->
      <MobileNav />
      <main class="col-span-2 lg:col-span-1 p-0 overflow-hidden">
        <div class="onload-animation">
          <section class="space-y-4">
            <!-- Header -->
            <div class="bg-white dark:bg-zinc-900 rounded-xl shadow-sm dark:shadow-gray-900/20 p-6">
              <nav class="flex items-center gap-2 text-sm text-neutral-500 dark:text-neutral-400 mb-4">
                <a href="/archive/" class="hover:text-sky-600 dark:hover:text-sky-400 transition-colors">
                  Archive
                </a>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8.59 16.58L13.17 12L8.59 7.41L10 6L16 12L10 18L8.59 16.58Z"/>
                </svg>
                <span class="text-zinc-900 dark:text-zinc-100 font-medium">Categories</span>
              </nav>
              
              <div class="flex items-center gap-3 mb-2">
                <div class="p-2 bg-sky-100 dark:bg-sky-900/20 rounded-lg">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sky-600 dark:text-sky-400">
                    <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div>
                  <h1 class="text-2xl md:text-3xl font-bold text-zinc-900 dark:text-zinc-100">Categories</h1>
                  <p class="text-neutral-500 dark:text-neutral-400">{categoriesArray.length} categories available</p>
                </div>
              </div>
            </div>

            <!-- Categories Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              {categoriesArray.map((category) => (
                <a href={`/archive/category/${category.category.replace(/\s+/g, '-')}/`} 
                   class="group bg-white dark:bg-zinc-900 rounded-xl shadow-sm dark:shadow-gray-900/20 hover:shadow-lg dark:hover:shadow-gray-900/40 transition-all duration-300 ease-out p-6">
                  <div class="flex items-center gap-4">
                    <div class="p-3 bg-sky-100 dark:bg-sky-900/20 rounded-lg group-hover:bg-sky-200 dark:group-hover:bg-sky-900/30 transition-colors">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-sky-600 dark:text-sky-400 group-hover:text-sky-700 dark:group-hover:text-sky-300 transition-colors">
                        <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="flex-1">
                      <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 group-hover:text-sky-600 dark:group-hover:text-sky-400 transition-colors mb-1">
                        {category.category}
                      </h3>
                      <p class="text-sm text-neutral-500 dark:text-neutral-400">
                        {category.count} {category.count === 1 ? 'post' : 'posts'}
                      </p>
                    </div>
                    <div class="text-neutral-400 group-hover:text-sky-500 transition-colors">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8.59 16.58L13.17 12L8.59 7.41L10 6L16 12L10 18L8.59 16.58Z"/>
                      </svg>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>
</Layout>
